/*! Firehose - v0.7.0 - 2014-03-21
* https://www.getfirehose.com
* Copyright (c) 2014 Adam Kirk; Licensed  */
(function(){var e,t,n,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},u=this;for(this.Stripe=function(){function e(){}return e.version=2,e.endpoint="https://api.stripe.com/v1",e.setPublishableKey=function(t){e.key=t},e.complete=function(t){return function(n){var s;return"success"!==n?(s=Math.round((new Date).getTime()/1e3),(new Image).src="http://q.stripe.com?event=stripejs-error&type="+n+"&key="+e.key+"&timestamp="+s,"function"==typeof t?t(500,{error:{code:n,type:n,message:"An unexpected error has occurred submitting your credit\ncard to our secure credit card processor. This may be\ndue to network connectivity issues, so you should try\nagain (you won't be charged twice). If this problem\npersists, please let us know!"}}):void 0):void 0}},e}.call(this),e=this.Stripe,this.Stripe.token=function(){function t(){}return t.validate=function(e,t){if(!e)throw t+" required";if("object"!=typeof e)throw t+" invalid"},t.formatData=function(t,n){return e.utils.isElement(t)&&(t=e.utils.paramsFromForm(t,n)),e.utils.underscoreKeys(t),t},t.create=function(t,n){return t.key||(t.key=e.key||e.publishableKey),e.utils.validateKey(t.key),e.ajaxJSONP({url:""+e.endpoint+"/tokens",data:t,method:"POST",success:function(e,t){return"function"==typeof n?n(t,e):void 0},complete:e.complete(n),timeout:4e4})},t.get=function(t,n){if(!t)throw"token required";return e.utils.validateKey(e.key),e.ajaxJSONP({url:""+e.endpoint+"/tokens/"+t,data:{key:e.key},success:function(e,t){return"function"==typeof n?n(t,e):void 0},complete:e.complete(n),timeout:4e4})},t}.call(this),this.Stripe.card=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.tokenName="card",n.whitelistedAttrs=["number","cvc","exp_month","exp_year","name","address_line1","address_line2","address_city","address_state","address_zip","address_country"],n.createToken=function(t,r,i){var s;return null==r&&(r={}),e.token.validate(t,"card"),"function"==typeof r?(i=r,r={}):"object"!=typeof r&&(s=parseInt(r,10),r={},s>0&&(r.amount=s)),r[n.tokenName]=e.token.formatData(t,n.whitelistedAttrs),e.token.create(r,i)},n.getToken=function(t,n){return e.token.get(t,n)},n.validateCardNumber=function(e){return e=(e+"").replace(/\s+|-/g,""),e.length>=10&&e.length<=16&&n.luhnCheck(e)},n.validateCVC=function(t){return t=e.utils.trim(t),/^\d+$/.test(t)&&t.length>=3&&t.length<=4},n.validateExpiry=function(t,n){var r,i;return t=e.utils.trim(t),n=e.utils.trim(n),/^\d+$/.test(t)&&/^\d+$/.test(n)&&parseInt(t,10)<=12?(i=new Date(n,t),r=new Date,i.setMonth(i.getMonth()-1),i.setMonth(i.getMonth()+1,1),i>r):!1},n.luhnCheck=function(e){var t,n,r,i,s,o;for(r=!0,i=0,n=(e+"").split("").reverse(),s=0,o=n.length;o>s;s++)t=n[s],t=parseInt(t,10),(r=!r)&&(t*=2),t>9&&(t-=9),i+=t;return i%10===0},n.cardType=function(e){return n.cardTypes[e.slice(0,2)]||"Unknown"},n.cardTypes=function(){var e,t,n,r;for(t={},e=n=40;49>=n;e=++n)t[e]="Visa";for(e=r=50;59>=r;e=++r)t[e]="MasterCard";return t[34]=t[37]="American Express",t[60]=t[62]=t[64]=t[65]="Discover",t[35]="JCB",t[30]=t[36]=t[38]=t[39]="Diners Club",t}(),n}.call(this,this.Stripe.token),this.Stripe.bankAccount=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.tokenName="bank_account",n.whitelistedAttrs=["country","routing_number","account_number"],n.createToken=function(t,r,i){return null==r&&(r={}),e.token.validate(t,"bank account"),"function"==typeof r&&(i=r,r={}),r[n.tokenName]=e.token.formatData(t,n.whitelistedAttrs),e.token.create(r,i)},n.getToken=function(t,n){return e.token.get(t,n)},n.validateRoutingNumber=function(t,r){switch(t=e.utils.trim(t),r){case"US":return/^\d+$/.test(t)&&9===t.length&&n.routingChecksum(t);case"CA":return/\d{5}\-\d{3}/.test(t)&&9===t.length;default:return!0}},n.validateAccountNumber=function(t,n){switch(t=e.utils.trim(t),n){case"US":return/^\d+$/.test(t)&&t.length>=1&&t.length<=17;default:return!0}},n.routingChecksum=function(e){var t,n,r,i,s,o;for(r=0,t=(e+"").split(""),o=[0,3,6],i=0,s=o.length;s>i;i++)n=o[i],r+=3*parseInt(t[n]),r+=7*parseInt(t[n+1]),r+=parseInt(t[n+2]);return 0!==r&&r%10===0},n}.call(this,this.Stripe.token),t=["createToken","getToken","cardType","validateExpiry","validateCVC","validateCardNumber"],r=0,i=t.length;i>r;r++)n=t[r],this.Stripe[n]=this.Stripe.card[n];"undefined"!=typeof module&&null!==module&&(module.exports=this.Stripe),"function"==typeof define&&define("stripe",[],function(){return u.Stripe})}).call(this),function(){var e,t,n,r=[].slice;e=encodeURIComponent,t=(new Date).getTime(),n=function(t,r,i){var s,o;null==r&&(r=[]);for(s in t)o=t[s],i&&(s=""+i+"["+s+"]"),"object"==typeof o?n(o,r,s):r.push(""+s+"="+e(o));return r.join("&").replace(/%20/g,"+")},this.Stripe.ajaxJSONP=function(e){var i,s,o,u,a,f;return null==e&&(e={}),o="sjsonp"+ ++t,a=document.createElement("script"),s=null,i=function(t){var n;return null==t&&(t="abort"),clearTimeout(s),null!=(n=a.parentNode)&&n.removeChild(a),o in window&&(window[o]=function(){}),"function"==typeof e.complete?e.complete(t,f,e):void 0},f={abort:i},a.onerror=function(){return f.abort(),"function"==typeof e.error?e.error(f,e):void 0},window[o]=function(){var t;t=1<=arguments.length?r.call(arguments,0):[],clearTimeout(s),a.parentNode.removeChild(a);try{delete window[o]}catch(n){window[o]=void 0}return"function"==typeof e.success&&e.success.apply(e,t),"function"==typeof e.complete?e.complete("success",f,e):void 0},e.data||(e.data={}),e.data.callback=o,e.method&&(e.data._method=e.method),a.src=e.url+"?"+n(e.data),u=document.getElementsByTagName("head")[0],u.appendChild(a),e.timeout>0&&(s=setTimeout(function(){return f.abort("timeout")},e.timeout)),f}}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};this.Stripe.utils=function(){function t(){}return t.trim=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},t.underscore=function(e){return(e+"").replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()}).replace(/-/g,"_")},t.underscoreKeys=function(e){var t,n,r;r=[];for(t in e)n=e[t],delete e[t],r.push(e[this.underscore(t)]=n);return r},t.isElement=function(e){return"object"!=typeof e?!1:"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery?!0:1===e.nodeType},t.paramsFromForm=function(t,n){var r,i,s,o,u,a,f,l,c,h;for(null==n&&(n=[]),"undefined"!=typeof jQuery&&null!==jQuery&&t instanceof jQuery&&(t=t[0]),s=t.getElementsByTagName("input"),u=t.getElementsByTagName("select"),a={},f=0,c=s.length;c>f;f++)i=s[f],r=this.underscore(i.getAttribute("data-stripe")),e.call(n,r)<0||(a[r]=i.value);for(l=0,h=u.length;h>l;l++)o=u[l],r=this.underscore(o.getAttribute("data-stripe")),e.call(n,r)<0||null!=o.selectedIndex&&(a[r]=o.options[o.selectedIndex].value);return a},t.validateKey=function(e){if(!e||"string"!=typeof e)throw new Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(e))throw new Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(e))throw new Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js")},t}()}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};this.Stripe.validator={"boolean":function(e,t){return"true"!==t&&"false"!==t?"Enter a boolean string (true or false)":void 0},integer:function(e,t){return/^\d+$/.test(t)?void 0:"Enter an integer"},positive:function(e,t){return!this.integer(e,t)&&parseInt(t,10)>0?void 0:"Enter a positive value"},range:function(t,n){var r;return r=parseInt(n,10),e.call(t,r)<0?"Needs to be between "+t[0]+" and "+t[t.length-1]:void 0},required:function(e,t){return!e||null!=t&&""!==t?void 0:"Required"},year:function(e,t){return/^\d{4}$/.test(t)?void 0:"Enter a 4-digit year"},birthYear:function(e,t){var n;return n=this.year(e,t),n?n:parseInt(t,10)>2e3?"You must be over 18":parseInt(t,10)<1900?"Enter your birth year":void 0},month:function(e,t){return this.integer(e,t)?"Please enter a month":this.range([1,2,3,4,5,6,7,8,9,10,11,12],t)?"Needs to be between 1 and 12":void 0},choices:function(t,n){return e.call(t,n)<0?"Not an acceptable value for this field":void 0},email:function(e,t){return/^[^@<\s>]+@[^@<\s>]+$/.test(t)?void 0:"That doesn't look like an email address"},url:function(e,t){return/^https?:\/\/.+\..+/.test(t)?void 0:"Not a valid url"},usTaxID:function(e,t){return/^\d{2}-?\d{1}-?\d{2}-?\d{4}$/.test(t)?void 0:"Not a valid tax ID"},ein:function(e,t){return/^\d{2}-?\d{7}$/.test(t)?void 0:"Not a valid EIN"},ssnLast4:function(e,t){return/^\d{4}$/.test(t)?void 0:"Not a valid last 4 digits for an SSN"},ownerPersonalID:function(e,t){var n;return n=function(){switch(e){case"CA":return/^\d{3}-?\d{3}-?\d{3}$/.test(t);case"US":return!0}}(),n?void 0:"Not a valid ID"},bizTaxID:function(e,t){var n,r,i,s,o,u,a,f;if(u={CA:["Tax ID",[/^\d{9}$/]],US:["EIN",[/^\d{2}-?\d{7}$/]]},o=u[e],null!=o){for(n=o[0],s=o[1],r=!1,a=0,f=s.length;f>a;a++)if(i=s[a],i.test(t)){r=!0;break}if(!r)return"Not a valid "+n}},zip:function(e,t){var n;return n=function(){switch(e.toUpperCase()){case"CA":return/^[\d\w]{6}$/.test(null!=t?t.replace(/\s+/g,""):void 0);case"US":return/^\d{5}$/.test(t)||/^\d{9}$/.test(t)}}(),n?void 0:"Not a valid zip"},bankAccountNumber:function(e,t){return/^\d{1,17}$/.test(t)?void 0:"Invalid bank account number"},usRoutingNumber:function(e){var t,n,r,i,s,o,u;if(!/^\d{9}$/.test(e))return"Routing number must have 9 digits";for(s=0,t=o=0,u=e.length-1;u>=o;t=o+=3)n=3*parseInt(e.charAt(t),10),r=7*parseInt(e.charAt(t+1),10),i=parseInt(e.charAt(t+2),10),s+=n+r+i;return 0===s||s%10!==0?"Invalid routing number":void 0},caRoutingNumber:function(e){return/^\d{5}\-\d{3}$/.test(e)?void 0:"Invalid transit number"},routingNumber:function(e,t){switch(e.toUpperCase()){case"CA":return this.caRoutingNumber(t);case"US":return this.usRoutingNumber(t)}},phoneNumber:function(e,t){var n;return n=t.replace(/[^0-9]/g,""),10!==n.length?"Invalid phone number":void 0},bizDBA:function(e,t){return/^.{1,23}$/.test(t)?void 0:"Statement descriptors can only have up to 23 characters"},nameLength:function(e,t){return 1===t.length?"Names need to be longer than one character":void 0}}}.call(this),window.Firehose={},Firehose.environment=function(){return Firehose.client.environment._inferEnvironmentFromURL(),Firehose.client.environment._environment},Firehose.baseURLFor=function(app,subdomain){return Firehose.client.environment.baseURLFor(app,subdomain)},Firehose.tokenFor=function(service){return Firehose.client.environment.serviceToken(service)};var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.UniqueArray=function(_super){function UniqueArray(){UniqueArray.__super__.constructor.apply(this,arguments)}return __extends(UniqueArray,_super),UniqueArray.prototype._sortOn=null,UniqueArray.prototype._sortDirection="asc",UniqueArray.prototype.appendObject=function(){var arg,_i,_len,_results;for(_results=[],_i=0,_len=arguments.length;_len>_i;_i++)arg=arguments[_i],_results.push(-1===this.indexOf(arg)?this.push(arg):void 0);return _results},UniqueArray.prototype.appendObjects=function(objects){var obj,_i,_len,_results;for(_results=[],_i=0,_len=objects.length;_len>_i;_i++)obj=objects[_i],_results.push(this.appendObject(obj));return _results},UniqueArray.prototype.insertObject=function(){return this.appendObject.apply(this,arguments),this.sortObjects()},UniqueArray.prototype.insertObjects=function(objects){return this.appendObjects(objects),this.sortObjects()},UniqueArray.prototype.dropObject=function(){var arg,idx,_i,_len,_results;for(_results=[],_i=0,_len=arguments.length;_len>_i;_i++)arg=arguments[_i],idx=this.indexOf(arg),_results.push(-1!==idx?this.splice(idx,1):void 0);return _results},UniqueArray.prototype.dropObjects=function(objects){var obj,_i,_len,_results;for(_results=[],_i=0,_len=objects.length;_len>_i;_i++)obj=objects[_i],_results.push(this.dropObject(obj));return _results},UniqueArray.prototype.sortOn=function(property,direction){return this._sortOn=property,this._sortDirection=direction||"asc"},UniqueArray.prototype.sortObjects=function(){var _this=this;if(null!=this._sortOn)return this.sort(function(obj1,obj2){return obj1[_this._sortOn]>obj2[_this._sortOn]?1:obj1[_this._sortOn]<obj2[_this._sortOn]?-1:0}),"desc"===this._sortDirection?this.reverse():void 0},UniqueArray.prototype._toArchivableJSON=function(){var archiveArray,obj,_i,_len;for(archiveArray=[],_i=0,_len=this.length;_len>_i;_i++)obj=this[_i],archiveArray.push(obj._toArchivableJSON());return archiveArray},UniqueArray}(Array);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.RemoteArray=function(_super){function RemoteArray(path,params,creationFunction){var _this=this;null==params&&(params={}),this._path=path,this._params=params,this._creationFunction=creationFunction,this._fetchingFunction=function(page){var options;return options={route:_this._path,auth:_this.auth,params:_this.onceParams?$.extend(_this.onceParams,_this._params):_this._params,page:page,perPage:_this.perPage},_this.onceParams=null,_this._currentXHR=Firehose.client.get(_this,options).done(function(data){var aggregate,json,object,_i,_len;if(data.constructor===Array&&data.length>0){for(_this.totalRows=data[0].total_rows,aggregate=[],_i=0,_len=data.length;_len>_i;_i++)json=data[_i],object=_this._creationFunction(json),object._populateWithJSON(json),aggregate.push(object);return _this.insertObjects(aggregate)}}).always(function(){return _this._currentXHR=null})}}return __extends(RemoteArray,_super),RemoteArray.prototype.perPage=-1,RemoteArray.prototype.page=1,RemoteArray.prototype.auth=!0,RemoteArray.prototype.totalRows=0,RemoteArray.prototype.onceParams=null,RemoteArray.prototype._path=null,RemoteArray.prototype._params=null,RemoteArray.prototype._creationFunction=null,RemoteArray.prototype._fetchingFunction=null,RemoteArray.prototype._fresh=!0,RemoteArray._currentXHR=null,RemoteArray.prototype.isAllLoaded=function(){return!this._fresh&&parseInt(this.length)===parseInt(this.totalRows)},RemoteArray.prototype.next=function(){return this._fresh||this.length!==this.totalRows?(this._fresh=!1,this._fetchingFunction(this.page++)):null},RemoteArray.prototype.abort=function(){var _ref;return null!=(_ref=this._currentXHR)?_ref.abort():void 0},RemoteArray.prototype.empty=function(){return this.dropObjects(this.splice(0))},RemoteArray.prototype.reset=function(){return this.empty(),this.totalRows=0,this._fresh=!0,this.page=1},RemoteArray}(Firehose.UniqueArray),Firehose.Environment=function(){function Environment(){}return Environment.prototype.baseURLFor=function(app,subdomain){var domain,port,scheme;return this._inferEnvironmentFromURL(),scheme=this._schemeFor(app),subdomain=subdomain&&subdomain+"."||"",domain=this._domainNameFor(app),port=this._portFor(app),""+scheme+subdomain+domain+port},Environment.prototype.serviceToken=function(service){var env;return this._inferEnvironmentFromURL(),env="production"===this._server?"production":this._environment,this._serviceKeys[env][service]},Environment.prototype.environment=function(){return this._inferEnvironmentFromURL(),this._environment},Environment.prototype._server=null,Environment.prototype._environment=null,Environment.prototype._typeNumber={server:3,client:4},Environment.prototype._serverNumber={local:0,mini:1,production:2},Environment.prototype._environmentNumber={development:0,test:1},Environment.prototype._appNumber={API:0,browser:1,billing:2,files:3,marketing:4,settings:5,tweetlonger:6,kb:7},Environment.prototype._appDomainNames={API:{development:"localhost",test:"localhost",beta:"api.firehoseapp.com",production:"api.firehoseapp.com"},browser:{development:"localhost",test:"localhost",beta:"beta.firehoseapp.com",production:"firehoseapp.com"},billing:{development:"localhost",test:"localhost",beta:"billing.firehoseapp.com",production:"billing.firehoseapp.com"},files:{development:"localhost",test:"localhost",beta:"frh.io",production:"frh.io"},marketing:{development:"localhost",test:"localhost",beta:"beta.getfirehose.com",production:"getfirehose.com"},settings:{development:"localhost",test:"localhost",beta:"beta_settings.firehoseapp.com",production:"settings.firehoseapp.com"},tweetlonger:{development:"localhost",test:"localhost",beta:"beta_tl.frh.io",production:"tl.frh.io"},kb:{development:"lvh.me",test:"lvh.me",beta:"firehosesupport.com",production:"firehosehelp.com"}},Environment.prototype._appTypes={API:"server",browser:"client",billing:"server",files:"server",marketing:"client",settings:"client",tweetlonger:"client",kb:"client"},Environment.prototype._serviceKeys={development:{stripe:"pk_test_oIyMNHil987ug1v8owRhuJwr",pusher:"2f64ac0434cc8a94526e"},test:{stripe:"pk_test_oIyMNHil987ug1v8owRhuJwr",pusher:"2f64ac0434cc8a94526e"},beta:{stripe:"pk_live_CGPaLboKkpr7tqswA4elf8NQ",pusher:"d3e373f7fac89de7bde8"},production:{stripe:"pk_live_CGPaLboKkpr7tqswA4elf8NQ",pusher:"d3e373f7fac89de7bde8"}},Environment.prototype._inferEnvironmentFromURL=function(){var currentURL,domainName,environmentNumber,key,serverNumber,value,_ref,_ref1;if(currentURL=document.createElement("a"),currentURL.href=window.unitTestDocumentURL||document.URL,domainName=currentURL.hostname.split(".").slice(-2).join("."),this._server="production",this._environment="production",parseInt(currentURL.port)>0){this._server="local",this._environment="development",serverNumber=parseInt(currentURL.port[1]),_ref=this._serverNumber;for(key in _ref)value=_ref[key],value===serverNumber&&(this._server=key);environmentNumber=parseInt(currentURL.port[2]),_ref1=this._environmentNumber;for(key in _ref1)value=_ref1[key],value===environmentNumber&&(this._environment=key)}return currentURL.hostname.match(/^beta(\.|_)/)?this._environment="beta":void 0},Environment.prototype._environmentFor=function(app){return"server"===this._appTypes[app]&&"production"===this._server?"production":this._environment},Environment.prototype._schemeFor=function(app){var environment;return environment=this._environmentFor(app),"development"===environment||"test"===environment||"kb"===app?"http://":"https://"},Environment.prototype._domainNameFor=function(app){var environment;return environment=this._environmentFor(app),this._appDomainNames[app][environment]},Environment.prototype._portFor=function(app){var environment,port;return environment=this._environmentFor(app),"production"===environment||"beta"===environment?"":(port=":",port+=this._typeNumber[this._appTypes[app]],port+="client"===this._appTypes[app]?this._serverNumber[this._server]:0,port+=this._environmentNumber[environment],port+=this._appNumber[app])},Environment.prototype._values=function(obj){var key,value,values;values=[];for(key in obj)value=obj[key],values.push(value);return values},Environment}(),Firehose.Client=function(){function Client(){this._firefoxHack(),this.environment=new Firehose.Environment,Stripe.setPublishableKey(this.environment.serviceToken("stripe"))}return Client.prototype.statusCodeHandlers=null,Client.prototype.errorHandler=null,Client.prototype.APIAccessToken=null,Client.prototype.URLToken=null,Client.prototype.billingAccessToken=null,Client.prototype.environment=null,Client.prototype.safariHackRequestCount=0,Client.prototype.get=function(object,options){return $.extend(options,{method:"GET"}),this._sendRequest(object,options)},Client.prototype.post=function(object,options){return $.extend(options,{method:"POST"}),this._sendRequest(object,options)},Client.prototype.put=function(object,options){return $.extend(options,{method:"PUT"}),this._sendRequest(object,options)},Client.prototype["delete"]=function(object,options){return $.extend(options,{method:"DELETE"}),this._sendRequest(object,options)},Client.prototype._sendRequest=function(object,options){var auth,body,defaults,headers,key,method,page,paramStrings,params,perPage,route,server,url,value,_this=this;defaults={server:"API",auth:!0,route:"",method:"GET",page:-1,perPage:-1,params:{},body:null},$.extend(defaults,options),server=defaults.server,auth=defaults.auth,route=defaults.route,method=defaults.method,page=defaults.page,perPage=defaults.perPage,params=defaults.params,body=defaults.body,page>-1&&(params.page=page),perPage>-1&&(params.per_page=perPage),this._safariHack(params),paramStrings=[];for(key in params)value=params[key],null!=value&&paramStrings.push(""+key+"="+encodeURIComponent(value));return url=""+this.environment.baseURLFor(server)+"/"+route,paramStrings.length>0&&(url+="?"+paramStrings.join("&")),headers={Accept:"application/json","X-Firehose-Environment":"beta"===this.environment.environment()?"beta":void 0},auth&&(null!=this.APIAccessToken&&"API"===server?$.extend(headers,{Authorization:'Token token="'+this.APIAccessToken+'"'}):null!=this.billingAccessToken&&"billing"===server&&$.extend(headers,{Authorization:'Token token="'+this.billingAccessToken+'"'})),$.ajax({type:method,url:url,data:body?JSON.stringify(body):void 0,processData:!1,dataType:"json",headers:headers,contentType:"application/json",statusCode:"API"===server?this.statusCodeHandlers||{}:void 0}).fail(function(jqXHR,textStatus,errorThrown){var errors,json,_ref,_results;if("API"===server&&(null!=_this.errorHandler&&_this.errorHandler(jqXHR,textStatus,errorThrown),422===Number(jqXHR.status)&&null!=jqXHR.responseJSON&&null!=object)){if(json=jqXHR.responseJSON,json.constructor===Object){object.clearErrors(),_ref=jqXHR.responseJSON,_results=[];for(key in _ref)errors=_ref[key],_results.push(object.errors.push(""+_this._humanize(key)+" "+errors.join(", ")));return _results}return object.errors=json.constructor===Array?json:(""+json).split("\n")}})},Client.prototype._firefoxHack=function(){var xhrCorsHeaders,_super;return _super=jQuery.ajaxSettings.xhr,xhrCorsHeaders=["Cache-Control","Content-Language","Content-Type","Expires","Last-Modified","Pragma"],jQuery.ajaxSettings.xhr=function(){var getAllResponseHeaders,xhr;return xhr=_super(),getAllResponseHeaders=xhr.getAllResponseHeaders,xhr.getAllResponseHeaders=function(){var allHeaders,e;allHeaders="";try{if(allHeaders=getAllResponseHeaders.apply(xhr),null!=allHeaders)return allHeaders}catch(_error){e=_error}return $.each(xhrCorsHeaders,function(i,headerName){return xhr.getResponseHeader(headerName)&&(allHeaders+=""+headerName+": "+xhr.getResponseHeader(headerName)+"\n"),!0}),allHeaders},xhr}},Client.prototype._safariHack=function(params){return this.safariHackRequestCount>6?void 0:(this.safariHackRequestCount++,navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")?params.safari_bug_cache_breaker=""+Math.random():void 0)},Client.prototype._humanize=function(str){return str.replace(/_id$/,"").replace(/_/g," ").replace(/\S\.\S/," ").replace(/^\w/g,function(s){return s.toUpperCase()})},Client}(),Firehose.client=new Firehose.Client,Firehose.Object=function(){function Object(properties){var prop;for(prop in properties)this[prop]=properties[prop]}return Object.prototype.id=null,Object.prototype.createdAt=null,Object.prototype.errors=[],Object._objects=[],Object.prototype._setup=function(){},Object.prototype.get=function(key){return this[key]},Object.prototype.set=function(key,value){return this[key]=value},Object.prototype.archive=function(key){var index;return null==key&&(key=this.id),index=""+this.constructor._firehoseType+"_"+key,localStorage[index]=JSON.stringify(this._toArchivableJSON())},Object.prototype.unarchive=function(key){var index,json;return null==key&&(key=this.id),index=""+this.constructor._firehoseType+"_"+key,null!=localStorage[index]?(json=$.parseJSON(localStorage[index]),this._populateWithJSON(json),!0):!1},Object.prototype.clearErrors=function(){return this.errors=[]},Object.prototype.HTMLErrorString=function(){var HTML,line,lines,_i,_len;if(HTML="<ul>",lines=this.errors,null!=lines)for(_i=0,_len=lines.length;_len>_i;_i++)line=lines[_i],HTML+="<li>"+line+"</li>";return HTML+="</ul>"},Object._objectOfClassWithID=function(klass,properties){var obj,parsedID,_i,_len,_ref;if(parsedID=parseInt(properties.id),isNaN(parsedID)||(properties.id=parsedID),parsedID)for(_ref=this._objects,_i=0,_len=_ref.length;_len>_i;_i++)if(obj=_ref[_i],obj.id&&obj.id===parsedID&&obj.constructor._firehoseType===klass._firehoseType)return obj;return obj=new klass(properties),obj._setup(),this._objects.push(obj),obj},Object.prototype._populateAssociatedObjects=function(owner,association,json,creation){var object,objectJSON,objects,_i,_len;if(null!=json){for(objects=new Firehose.UniqueArray,_i=0,_len=json.length;_len>_i;_i++)objectJSON=json[_i],object=creation(objectJSON),object._populateWithJSON(objectJSON),objects.push(object);return owner.set(association,objects)}},Object.prototype._populateAssociatedObjectWithJSON=function(owner,association,json,creation){var object;return null!=json?(object=creation(json),owner.set(association,object),object._populateWithJSON(json)):void 0},Object.prototype._populateAssociatedObjectWithID=function(owner,association,id,creation){return owner.set(association,null!=id?creation(id):null)},Object.prototype._populateWithJSON=function(json){return null==this.id&&this._setIfNotNull("id",json.id),this.createdAt?void 0:this._setIfNotNull("createdAt",this._date(json.created_at))},Object.prototype._setIfNotNull=function(key,value){return null!=value?this.set(key,value):void 0},Object.prototype._toArchivableJSON=function(){return{id:this.id,created_at:this.createdAt}},Object.prototype._textOrNull=function(value){return null!=value?value.length>0?value:null:void 0},Object.prototype._date=function(dateString){var date;return date=new Date(dateString),isNaN(date)?null:date},Object}();var _ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.Agent=function(_super){function Agent(){return this._handleSuccessfulLogin=__bind(this._handleSuccessfulLogin,this),_ref=Agent.__super__.constructor.apply(this,arguments)}return __extends(Agent,_super),Agent._firehoseType="Agent",Agent.loggedInAgent=null,Agent.prototype.accessToken=null,Agent.prototype.URLToken=null,Agent.prototype.firstName=null,Agent.prototype.lastName=null,Agent.prototype.email=null,Agent.prototype.currentCompany=null,Agent.prototype._password=null,Agent.prototype.companies=null,Agent.prototype._setup=function(){return this.companies=new Firehose.UniqueArray},Agent.agentWithAccessToken=function(accessToken){return Firehose.Object._objectOfClassWithID(Firehose.Agent,{accessToken:accessToken})},Agent.agentWithEmailAndPassword=function(email,password){return Firehose.Object._objectOfClassWithID(Firehose.Agent,{email:email,_password:password})},Agent.agentWithID=function(id){return Firehose.Object._objectOfClassWithID(Firehose.Agent,{id:id})},Agent.prototype.signUpWithFirstAndLastName=function(firstName,lastName,inviteToken){var params,_this=this;return this._setIfNotNull("firstName",firstName),this._setIfNotNull("lastName",lastName),params={route:"agents",body:{token:null!=inviteToken?inviteToken:void 0,agent:{email:this.email,password:this._password,first_name:this.firstName,last_name:this.lastName}}},Firehose.client.post(this,params).done(function(data){return _this._populateWithJSON(data),_this._handleSuccessfulLogin()})},Agent.prototype.login=function(){var params,_this=this;return null!=this.firstName&&this.lastName&&null!=this.email?(this._handleSuccessfulLogin(),$.Deferred().resolve(this._toArchivableJSON())):(Firehose.client.APIAccessToken=null,params={route:"login"},null!=this.email&&null!=this._password?params.body={email:this.email,password:this._password}:null!=this.accessToken&&(Firehose.client.APIAccessToken=this.accessToken),Firehose.client.post(this,params).done(function(data){return _this._populateWithJSON(data),_this._handleSuccessfulLogin()}))},Agent.prototype.logout=function(){var params,_this=this;return params={route:"logout"},Firehose.client["delete"](this,params).always(function(){return _this._setIfNotNull("accessToken",null),_this._setIfNotNull("URLToken",null),Firehose.Agent.loggedInAgent=null,Firehose.client.APIAccessToken=null,Firehose.client.URLToken=null,Firehose.client.billingAccessToken=null})},Agent.prototype.fetch=function(){var params,_this=this;return params={route:"agents/"+this.id},Firehose.client.get(this,params).done(function(data){return _this._populateWithJSON(data),_this._handleSuccessfulLogin()})},Agent.prototype.save=function(){var params;return params={route:"agents/"+this.id,body:this._toJSON()},Firehose.client.put(this,params)},Agent.prototype.destroy=function(){var params,_this=this;return params={route:"agents/"+this.id},Firehose.client["delete"](this,params).done(function(){var company,_i,_len,_ref1,_results;for(_ref1=_this.companies,_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)company=_ref1[_i],_results.push(company.agents.dropObject(_this));return _results})},Agent.prototype.dismissNotifications=function(notifications){var ids,notification,params,_i,_len;for(ids=[],_i=0,_len=notifications.length;_len>_i;_i++)notification=notifications[_i],ids.push(notification.id);return params={route:"agents/"+this.id+"/notifications/"+ids.join(",")},Firehose.client.put(this,params)},Agent.requestPasswordReset=function(email){var params;return params={route:"request_reset_password",body:{email:email}},Firehose.client.post(this,params)},Agent.resetPassword=function(token,newPassword){var params;return params={route:"reset_password",body:{token:token,password:newPassword}},Firehose.client.post(this,params)},Agent.prototype.setNewPassword=function(newPassword){return this._setIfNotNull("_password",newPassword)},Agent.prototype.fullName=function(){return""+this.firstName+" "+this.lastName},Agent.prototype.gravatarURL=function(){var e,hashedEmail;return this.email&&(e=this.email.trim().toLowerCase(),hashedEmail=md5(e)),"https://www.gravatar.com/avatar/"+hashedEmail+"?d=identicon"},Agent.prototype._handleSuccessfulLogin=function(){return Firehose.client.APIAccessToken=this.accessToken,Firehose.client.URLToken=this.URLToken,Firehose.Agent.loggedInAgent=this},Agent.prototype._populateWithJSON=function(json){var _this=this;return null==this.accessToken&&this._setIfNotNull("accessToken",json.browser_token),null==this.URLToken&&this._setIfNotNull("URLToken",json.url_token),this._setIfNotNull("firstName",json.first_name),this._setIfNotNull("lastName",json.last_name),this._setIfNotNull("email",json.email),this._populateAssociatedObjects(this,"companies",json.companies,function(json){return Firehose.Company.companyWithID(json.id,null,_this)}),this.companies.length>0&&null==this.currentCompany&&this._setIfNotNull("currentCompany",this.companies[0]),Agent.__super__._populateWithJSON.call(this,json)},Agent.prototype._toJSON=function(){return{agent:{first_name:this.firstName,last_name:this.lastName,email:this.email,password:null!=this._password?this._password:void 0}}},Agent.prototype._toArchivableJSON=function(){var _ref1;return $.extend(Agent.__super__._toArchivableJSON.call(this),{access_token:this.accessToken,url_token:this.URLToken,first_name:this.firstName,last_name:this.lastName,email:this.email,password:null!=this._password?this._password:void 0,companies:null!=(_ref1=this.companies)?_ref1._toArchivableJSON():void 0})
},Agent}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.Company=function(_super){function Company(){return _ref=Company.__super__.constructor.apply(this,arguments)}return __extends(Company,_super),Company._firehoseType="Company",Company.prototype.title=null,Company.prototype.token=null,Company.prototype.lastFetchAt=null,Company.prototype.forwardingEmailAddress=null,Company.prototype.unresolvedCount=0,Company.prototype.numberOfAccounts=0,Company.prototype.fetchAutomatically=!0,Company.prototype.knowledgeBaseSubdomain=null,Company.prototype.knowledgeBaseCustomDomain=null,Company.prototype.knowledgeBaseCSS=null,Company.prototype.knowlegeBaseLayoutTemplate=null,Company.prototype.knowlegeBaseSearchTemplate=null,Company.prototype.knowlegeBaseArticleTemplate=null,Company.prototype.agents=null,Company.prototype.agentInvites=null,Company.prototype.tags=null,Company.prototype.cannedResponses=null,Company.prototype._customers=null,Company.prototype._notifications=null,Company.prototype._twitterAccounts=null,Company.prototype._facebookAccounts=null,Company.prototype._emailAccounts=null,Company.prototype._articles=null,Company.prototype._searchedArticles=null,Company.prototype.creditCard=null,Company.prototype.billingEmail=null,Company.prototype.billingRate=-1,Company.prototype.nextBillAmountBeforeDiscounts=0,Company.prototype.nextBillAmountAfterDiscounts=0,Company.prototype.isFreeTrialEligible=!1,Company.prototype.trialExpirationDate=null,Company.prototype.discounts=null,Company.prototype.nextBillingDate=null,Company.prototype.isGracePeriodOver=!1,Company.prototype.daysLeftInGracePeriod=-1,Company.prototype.isCurrent=!1,Company.prototype.hasSuccessfulBilling=!1,Company.prototype._creator=null,Company.prototype._setup=function(){return this.agents=new Firehose.UniqueArray,this.agentInvites=new Firehose.UniqueArray,this.tags=new Firehose.UniqueArray,this.cannedResponses=new Firehose.UniqueArray,this.agents.sortOn("firstName"),this.tags.sortOn("label"),this.cannedResponses.sortOn("name")},Company.companyWithTitle=function(title,creator){return Firehose.Object._objectOfClassWithID(Firehose.Company,{title:title,_creator:creator||Firehose.Agent.loggedInAgent})},Company.companyWithID=function(id,token,creator){return Firehose.Object._objectOfClassWithID(Firehose.Company,{id:id,token:token,_creator:creator})},Company.companyWithKBSubdomain=function(subdomain){return Firehose.Object._objectOfClassWithID(Firehose.Company,{knowledgeBaseSubdomain:subdomain})},Company.companyWithKBCustomDomain=function(customDomain){return Firehose.Object._objectOfClassWithID(Firehose.Company,{knowledgeBaseCustomDomain:customDomain})},Company.prototype.fetch=function(options){var request,requested_settings,_this=this;if(null==options&&(options={}),null!=this.id)requested_settings=null!=options.include_settings?"?include="+options.include_settings.join(","):"",request={route:"companies/"+this.id+requested_settings};else if(this.knowledgeBaseSubdomain)request={auth:!1,route:"companies",params:{kb_subdomain:this.knowledgeBaseSubdomain}};else{if(!this.knowledgeBaseCustomDomain)throw"You can't call 'fetch' on a company unless 'id', 'knowledgeBaseSubdomain' or 'knowledgeBaseCustomDomain' is set.";request={auth:!1,route:"companies",params:{kb_custom_domain:this.knowledgeBaseCustomDomain}}}return Firehose.client.get(this,request).done(function(data){return _this._populateWithJSON(data)})},Company.prototype.save=function(){var params,_this=this;return null!=this.id?(params={route:"companies/"+this.id,body:this._toJSON()},Firehose.client.put(this,params)):(params={route:"agents/"+this._creator.id+"/companies",body:this._toJSON()},Firehose.client.post(this,params).done(function(data){return _this._populateWithJSON(data)}))},Company.prototype.forceChannelsFetch=function(){var params;return params={route:"companies/"+this.id+"/force_channels_fetch"},Firehose.client.put(this,params)},Company.prototype.destroy=function(){var params,_this=this;return params={route:"companies/"+this.id},Firehose.client["delete"](this,params).done(function(){return Firehose.Agent.loggedInAgent.companies.dropObject(_this)})},Company.prototype.customersWithCriteria=function(criteria){var params,_this=this;return null==criteria&&(criteria={}),params={filter:null!=criteria.everything&&criteria.everything?"everything":"unresolved",channel:null!=criteria.channels?criteria.channels.join(","):void 0,sort:null!=criteria.sort?criteria.sort:"newest_first",search_text:criteria.searchString?encodeURIComponent(criteria.searchString):void 0},this._customers=new Firehose.RemoteArray("companies/"+this.id+"/customers",params,function(json){return Firehose.Customer.customerWithID(json.id,_this)}),"newest_first"===params.sort?this._customers.sortOn("newestInteractionReceivedAt","desc"):this._customers.sortOn("newestInteractionReceivedAt","asc"),null!=criteria.preFetch&&(this._customers.onceParams={pre_fetch:criteria.preFetch}),this._customers},Company.prototype.notifications=function(){var _this=this;return null==this._notifications&&(this._setIfNotNull("_notifications",new Firehose.RemoteArray("companies/"+this.id+"/notifications",null,function(json){return Firehose.Notification._notificationWithID(json.id,_this)})),this._notifications.sortOn("title")),this._notifications},Company.prototype.twitterAccounts=function(){var _this=this;return null==this._twitterAccounts&&(this._setIfNotNull("_twitterAccounts",new Firehose.RemoteArray("companies/"+this.id+"/twitter_accounts",null,function(json){return Firehose.TwitterAccount._twitterAccountWithID(json.id,_this)})),this._twitterAccounts.sortOn("screenName")),this._twitterAccounts},Company.prototype.facebookAccounts=function(){var _this=this;return null==this._facebookAccounts&&(this._setIfNotNull("_facebookAccounts",new Firehose.RemoteArray("companies/"+this.id+"/facebook_accounts",null,function(json){return Firehose.FacebookAccount._facebookAccountWithID(json.id,_this)})),this._facebookAccounts.sortOn("name")),this._facebookAccounts},Company.prototype.emailAccounts=function(){var _this=this;return null==this._emailAccounts&&(this._setIfNotNull("_emailAccounts",new Firehose.RemoteArray("companies/"+this.id+"/email_accounts",null,function(json){return Firehose.EmailAccount._emailAccountWithID(json.id,_this)})),this._emailAccounts.sortOn("username")),this._emailAccounts},Company.prototype.articles=function(){var articlesRemoteArray,_this=this;return null==this._articles&&(articlesRemoteArray=new Firehose.RemoteArray("companies/"+this.id+"/articles",null,function(json){return Firehose.Article.articleWithID(json.id,_this)}),articlesRemoteArray.auth=!1,this._setIfNotNull("_articles",articlesRemoteArray)),this._articles},Company.prototype.searchedArticles=function(text){var articlesRemoteArray,currentSearchedArticles,_this=this;return currentSearchedArticles=this.get("_searchedArticles"),currentSearchedArticles&&currentSearchedArticles.abort(),articlesRemoteArray=new Firehose.RemoteArray("companies/"+this.id+"/article_search",{q:text},function(json){var article;return article=Firehose.Article.articleWithID(json.id,_this),article._populateWithJSON(json),article}),articlesRemoteArray.auth=!1,this._setIfNotNull("_searchedArticles",articlesRemoteArray),articlesRemoteArray},Company.prototype.addAgent=function(agent){var params,_this=this;return params={route:"companies/"+this.id+"/agents/"+agent.id},Firehose.client.put(this,params).done(function(){return _this.agents.insertObject(agent)})},Company.prototype.removeAgent=function(agent){var params,_this=this;return params={route:"companies/"+this.id+"/agents/"+agent.id},Firehose.client["delete"](this,params).done(function(){return _this.agents.dropObject(agent)})},Company.prototype.fetchBillingInfo=function(){var fetchBlock,_this=this;return fetchBlock=function(){var params;return Firehose.client.billingAccessToken=_this.token,params={server:"billing",route:"entities/"+_this.id},Firehose.client.get(_this,params).done(function(json){var discount,discountAmt,discountAmtStr,totalDiscount,_i,_len,_ref1;for(null!=json.credit_card&&(_this._setIfNotNull("creditCard",Firehose.CreditCard.creditCardWithID(json.credit_card.id,_this)),_this.creditCard._populateWithJSON(json.credit_card)),_this._setIfNotNull("billingEmail",json.email||Firehose.Agent.loggedInAgent.email),_this._setIfNotNull("billingRate",(json.rate/100).toFixed(2)),_this._setIfNotNull("nextBillAmountBeforeDiscounts",(_this.billingRate*_this.agents.length).toFixed(2)),_this._setIfNotNull("isFreeTrialEligible",json.is_free_trial_eligible),_this._setIfNotNull("trialExpirationDate",_this._date(json.free_trial_expiration_date)||new Date(+new Date+12096e5)),_this._setIfNotNull("nextBillingDate",json.next_bill_date?_this._date(json.next_bill_date):void 0),_this._setIfNotNull("isGracePeriodOver",json.grace_period_over),_this._setIfNotNull("daysLeftInGracePeriod",json.days_left_in_grace_period),_this._setIfNotNull("isCurrent",json.current),_this._setIfNotNull("hasSuccessfulBilling",json.has_successful_billing),totalDiscount=0,discountAmt=0,discountAmtStr="",_this.discounts=[],_ref1=json.discount_list,_i=0,_len=_ref1.length;_len>_i;_i++)discount=_ref1[_i],"fixed amount"===discount.apply_type?(discountAmt=(discount.amount/100).toFixed(2),discountAmtStr="$"+discountAmt,totalDiscount=Number(totalDiscount)+Number(discountAmt)):(discountAmt=discount.amount,discountAmtStr=discountAmt+"%",totalDiscount=Number(totalDiscount)+Number(_this.nextBillAmountBeforeDiscounts*(discountAmt/100))),_this.discounts.push({name:discount.name,applyType:discount.apply_type,amount:discountAmt,amountStr:discountAmtStr,expirationDate:discount.expiration_date?_this._date(discount.expiration_date):void 0});return _this.nextBillAmountAfterDiscounts=(Number(totalDiscount)>Number(_this.nextBillAmountBeforeDiscounts)?0:_this.nextBillAmountBeforeDiscounts-totalDiscount).toFixed(2)})},this.token?fetchBlock():this.fetch().then(function(){return fetchBlock()})},Company.prototype.extendTrial=function(){var requestBlock,_this=this;return requestBlock=function(){var params;return Firehose.client.billingAccessToken=_this.token,params={server:"billing",route:"entities/"+_this.id+"/renew_trial"},Firehose.client.put(_this,params).done(function(json){return _this._setIfNotNull("trialExpirationDate",_this._date(json.free_trial_expiration_date))})},this.token?requestBlock():this.fetch().then(function(){return requestBlock()})},Company.prototype.kbBaseURL=function(){var customDomain;return"production"===Firehose.environment()&&(customDomain=this.get("knowledgeBaseCustomDomain"))?"http://"+customDomain:Firehose.baseURLFor("kb",this.get("knowledgeBaseSubdomain"))},Company.prototype._populateWithJSON=function(json){var _ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_this=this;return this._setIfNotNull("title",json.title),null==this.token&&this._setIfNotNull("token",json.token),null!=json.last_fetch_at&&this._setIfNotNull("lastFetchAt",this._date(json.last_fetch_at)),null==this.forwardingEmailAddress&&this._setIfNotNull("forwardingEmailAddress",json.forwarding_email),this._setIfNotNull("unresolvedCount",json.unresolved_count),this._setIfNotNull("numberOfAccounts",json.number_of_accounts),this._setIfNotNull("fetchAutomatically",null!=(_ref1=json.company_settings)?_ref1.fetch_automatically:void 0),this._setIfNotNull("knowledgeBaseSubdomain",null!=(_ref2=json.company_settings)?_ref2.kb_subdomain:void 0),this._setIfNotNull("knowledgeBaseCustomDomain",null!=(_ref3=json.company_settings)?_ref3.kb_custom_domain:void 0),this._setIfNotNull("knowledgeBaseCSS",null!=(_ref4=json.company_settings)?_ref4.kb_css:void 0),this._setIfNotNull("knowledgeBaseLayoutTemplate",null!=(_ref5=json.company_settings)?_ref5.kb_layout_template:void 0),this._setIfNotNull("knowledgeBaseSearchTemplate",null!=(_ref6=json.company_settings)?_ref6.kb_search_template:void 0),this._setIfNotNull("knowledgeBaseArticleTemplate",null!=(_ref7=json.company_settings)?_ref7.kb_article_template:void 0),this._populateAssociatedObjects(this,"agents",json.agents,function(json){var agent;return agent=Firehose.Agent.agentWithID(json.id),agent.companies.insertObject(_this),agent}),this._populateAssociatedObjects(this,"agentInvites",json.agent_invites,function(json){return Firehose.AgentInvite._agentInviteWithID(json.id,_this)}),this._populateAssociatedObjects(this,"tags",json.tags,function(json){return Firehose.Tag._tagWithID(json.id,_this)}),this._populateAssociatedObjects(this,"cannedResponses",json.canned_responses,function(json){return Firehose.CannedResponse._cannedResponseWithID(json.id,_this)}),Firehose.client.billingAccessToken=this.token,Company.__super__._populateWithJSON.call(this,json)},Company.prototype._toJSON=function(){return{company:{title:this.title,company_settings_attributes:{fetch_automatically:this.fetchAutomatically,kb_subdomain:this._textOrNull(this.knowledgeBaseSubdomain),kb_custom_domain:this._textOrNull(this.knowledgeBaseCustomDomain),kb_css:this._textOrNull(this.knowledgeBaseCSS),kb_layout_template:this._textOrNull(this.knowledgeBaseLayoutTemplate),kb_search_template:this._textOrNull(this.knowledgeBaseSearchTemplate),kb_article_template:this._textOrNull(this.knowledgeBaseArticleTemplate)}}}},Company.prototype._toArchivableJSON=function(){return $.extend(Company.__super__._toArchivableJSON.call(this),{title:this.title,token:this.token,fetch_automatically:this.fetchAutomatically,last_fetch_at:this.lastFetchAt,forwarding_email:this.forwardingEmailAddress,kb_subdomain:this.knowledgeBaseSubdomain,unresolved_count:this.unresolvedCount,number_of_accounts:this.numberOfAccounts,agent_invites:this.agentInvites._toArchivableJSON(),tags:this.tags._toArchivableJSON(),canned_responses:this.cannedResponses._toArchivableJSON()})},Company}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.Interaction=function(_super){function Interaction(){return _ref=Interaction.__super__.constructor.apply(this,arguments)}return __extends(Interaction,_super),Interaction._firehoseType="Interaction",Interaction.prototype.customer=null,Interaction.prototype.token=null,Interaction.prototype.responseDraft=null,Interaction.prototype.happiness=null,Interaction.prototype.resolved=!1,Interaction.prototype.isOutgoing=null,Interaction.prototype.body=null,Interaction.prototype.privateURL=null,Interaction.prototype.channel=null,Interaction.prototype.receivedAt=null,Interaction.prototype.customerAccount=null,Interaction.prototype.agent=null,Interaction.prototype.originalInteraction=null,Interaction.prototype.responseInteractions=null,Interaction.prototype.notes=null,Interaction.prototype.tags=null,Interaction.prototype.flaggedAgents=null,Interaction.prototype._setup=function(){return this.responseInteractions=new Firehose.UniqueArray,this.notes=new Firehose.UniqueArray,this.tags=new Firehose.UniqueArray,this.flaggedAgents=new Firehose.UniqueArray,this.responseInteractions.sortOn("receivedAt"),this.notes.sortOn("createdAt"),this.tags.sortOn("label"),this.flaggedAgents.sortOn("firstName")},Interaction.interactionWithToken=function(token){return Firehose.Object._objectOfClassWithID(Firehose.Interaction,{token:token})},Interaction._interactionWithJSON=function(json,customer){var interaction;return interaction=null,"twitter"===json.channel?interaction=Firehose.TwitterInteraction._twitterInteractionWithID(json.id):"facebook"===json.channel?interaction=Firehose.FacebookInteraction._facebookInteractionWithID(json.id):"email"===json.channel&&(interaction=Firehose.EmailInteraction._emailInteractionWithID(json.id)),interaction._setCustomer(customer),interaction._populateWithJSON(json),interaction},Interaction.prototype.subject=function(){return"EmailInteraction"===this.constructor._firehoseType?this.emailSubject:"TwitterInteraction"===this.constructor._firehoseType?this.inReplyToScreenName?"Reply to "+this.inReplyToScreenName:"Mention of "+this.toScreenName:"FacebookInteraction"===this.constructor._firehoseType?this.type[0].toUpperCase()+this.type.slice(1):void 0},Interaction.prototype.reply=function(){var body,params,_this=this;return body={interaction:{body:this.responseDraft}},params={route:"interactions/"+this.id+"/reply",body:body},Firehose.client.post(this,params).done(function(data){var response;return _this._setIfNotNull("responseDraft",null),response=Firehose.Interaction._interactionWithJSON(data,_this.customer),_this.responseInteractions.insertObject(response),response._setIfNotNull("agent",Firehose.Agent.loggedInAgent),_this.responseInteractions.sort(function(interaction1,interaction2){return interaction1.createdAt>interaction2.createdAt})})},Interaction.prototype.save=function(){var params;return params={route:"interactions/"+this.id,body:this._toJSON()},Firehose.client.put(this,params)},Interaction.prototype.fetch=function(){var params,_this=this;return params={route:"interactions/"+(this.token||this.id)},Firehose.client.get(this,params).done(function(data){return _this._populateWithJSON(data)})},Interaction.prototype.destroy=function(){var params,_this=this;return params={route:"interactions/"+this.id},Firehose.client["delete"](this,params).done(function(){return _this.customer.interactions().dropObject(_this)})},Interaction.prototype.addTag=function(tag){var params,_this=this;return params={route:"interactions/"+this.id+"/tags/"+tag.id},Firehose.client.put(this,params).done(function(){return _this.tags.insertObject(tag)})},Interaction.prototype.removeTag=function(tag){var params,_this=this;return params={route:"interactions/"+this.id+"/tags/"+tag.id},Firehose.client["delete"](this,params).done(function(){return _this.tags.dropObject(tag)})},Interaction.prototype.flagAgent=function(agent){var params,_this=this;return params={route:"interactions/"+this.id+"/agents/"+agent.id},Firehose.client.put(this,params).done(function(){return _this.flaggedAgents.insertObject(agent)})},Interaction.prototype.unflagAgent=function(agent){var params,_this=this;return params={route:"interactions/"+this.id+"/agents/"+agent.id},Firehose.client["delete"](this,params).done(function(){return _this.flaggedAgents.dropObject(agent)})},Interaction.prototype.happinessString=function(){return 0===this.happiness?"Upset":1===this.happiness?"Satisfied":2===this.happiness?"Happy":void 0},Interaction.prototype._setCustomer=function(customer){return this._setIfNotNull("customer",customer)},Interaction.prototype._populateWithJSON=function(json){var _this=this;return null==this.token&&this._setIfNotNull("token",json.token),this._setIfNotNull("body",json.body),this._setIfNotNull("responseDraft",json.response_draft),this._setIfNotNull("channel",json.channel),this._setIfNotNull("receivedAt",this._date(json.received_at)),this._setIfNotNull("privateURL",json.private_url),this._setIfNotNull("happiness",json.happiness),this._setIfNotNull("resolved",json.resolved),this._setIfNotNull("isOutgoing",json.outgoing),this._populateAssociatedObjectWithJSON(this,"agent",json.agent,function(json){return Firehose.Agent.agentWithID(json.id)}),this._populateAssociatedObjectWithJSON(this,"customerAccount",json.customer_account,function(json){return json.channel=_this.channel,Firehose.CustomerAccount._customerAccountWithID(json.id,_this.customer)}),this._populateAssociatedObjects(this,"responseInteractions",json.response_interactions,function(json){var interaction;return json.channel=_this.channel,interaction=Firehose.Interaction._interactionWithJSON(json,_this.customer),interaction.set("originalInteraction",_this),interaction}),this._populateAssociatedObjects(this,"notes",json.notes,function(json){return Firehose.Note._noteWithID(json.id,_this)}),this._populateAssociatedObjects(this,"tags",json.tags,function(json){return Firehose.Tag._tagWithID(json.id,_this.customer.company)}),this._populateAssociatedObjects(this,"flaggedAgents",json.flagged_agents,function(json){return Firehose.Agent.agentWithID(json.id)}),Interaction.__super__._populateWithJSON.call(this,json)},Interaction.prototype._toJSON=function(){return{interaction:{resolved:this.resolved,response_draft:this.responseDraft}}},Interaction}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.AgentInvite=function(_super){function AgentInvite(){return _ref=AgentInvite.__super__.constructor.apply(this,arguments)}return __extends(AgentInvite,_super),AgentInvite._firehoseType="AgentInvite",AgentInvite.prototype.toEmail=null,AgentInvite.prototype.company=null,AgentInvite.agentInviteWithEmail=function(email,company){return Firehose.Object._objectOfClassWithID(Firehose.AgentInvite,{toEmail:email,company:company})},AgentInvite._agentInviteWithID=function(id,company){return Firehose.Object._objectOfClassWithID(Firehose.AgentInvite,{id:id,company:company})},AgentInvite.prototype.save=function(){var params,_this=this;return params={route:"companies/"+this.company.id+"/agent_invites",body:this._toJSON()},Firehose.client.post(this,params).done(function(data){return _this._populateWithJSON(data),_this.company.agentInvites.insertObject(_this)})},AgentInvite.prototype.resend=function(){var params;return params={route:"agent_invites/"+this.id+"/resend"},Firehose.client.put(this,params)},AgentInvite.prototype.destroy=function(){var params,_this=this;return params={route:"agent_invites/"+this.id},Firehose.client["delete"](this,params).done(function(){return _this.company.agentInvites.dropObject(_this)})},AgentInvite.prototype._populateWithJSON=function(json){return this._setIfNotNull("email",json.email),AgentInvite.__super__._populateWithJSON.call(this,json)},AgentInvite.prototype._toJSON=function(){return{agent_invite:{email:this.toEmail}}},AgentInvite.prototype._toArchivableJSON=function(){return $.extend(AgentInvite.__super__._toArchivableJSON.call(this),{email:this.toEmail})},AgentInvite}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.Attachment=function(_super){function Attachment(){return _ref=Attachment.__super__.constructor.apply(this,arguments)}return __extends(Attachment,_super),Attachment._firehoseType="Attachment",Attachment.prototype.emailInteraction=null,Attachment.prototype.filename=null,Attachment.prototype.temporaryURL=null,Attachment._attachmentWithID=function(id,emailInteraction){return Firehose.Object._objectOfClassWithID(Firehose.Attachment,{id:id,emailInteraction:emailInteraction})},Attachment.prototype._populateWithJSON=function(json){return this._setIfNotNull("filename",json.filename),this._setIfNotNull("temporaryURL",json.temporary_url),Attachment.__super__._populateWithJSON.call(this,json)},Attachment}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.CannedResponse=function(_super){function CannedResponse(){return _ref=CannedResponse.__super__.constructor.apply(this,arguments)}return __extends(CannedResponse,_super),CannedResponse._firehoseType="CannedResponse",CannedResponse.prototype.company=null,CannedResponse.prototype.name=null,CannedResponse.prototype.shortcut=null,CannedResponse.prototype.text=null,CannedResponse.cannedResponseWithNameAndText=function(name,text,company){return Firehose.Object._objectOfClassWithID(Firehose.CannedResponse,{name:name,text:text,company:company})},CannedResponse._cannedResponseWithID=function(id,company){return Firehose.Object._objectOfClassWithID(Firehose.CannedResponse,{id:id,company:company})},CannedResponse.prototype.save=function(){var params,_this=this;return null!=this.id?(params={route:"canned_responses/"+this.id,body:this._toJSON()},Firehose.client.put(this,params)):(params={route:"companies/"+this.company.id+"/canned_responses",body:this._toJSON()},Firehose.client.post(this,params).done(function(data){return _this._populateWithJSON(data),_this.company.cannedResponses.insertObject(_this)}))},CannedResponse.prototype.destroy=function(){var params,_this=this;return params={route:"canned_responses/"+this.id},Firehose.client["delete"](this,params).done(function(){return _this.company.cannedResponses.dropObject(_this)})},CannedResponse.prototype._populateWithJSON=function(json){return this._setIfNotNull("name",json.name),this._setIfNotNull("shortcut",json.shortcut),this._setIfNotNull("text",json.text),CannedResponse.__super__._populateWithJSON.call(this,json)},CannedResponse.prototype._toJSON=function(){return{canned_response:{name:this.name,shortcut:this.shortcut,text:this.text}}},CannedResponse.prototype._toArchivableJSON=function(){return $.extend(CannedResponse.__super__._toArchivableJSON.call(this),{name:this.name,shortcut:this.shortcut,text:this.text})},CannedResponse}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.CreditCard=function(_super){function CreditCard(){return _ref=CreditCard.__super__.constructor.apply(this,arguments)}return __extends(CreditCard,_super),CreditCard._firehoseType="CreditCard",CreditCard.prototype.company=null,CreditCard.prototype.number=null,CreditCard.prototype.cvc=null,CreditCard.prototype.expirationMonth=null,CreditCard.prototype.expirationYear=null,CreditCard.prototype.lastFour=null,CreditCard.prototype.stripeToken=null,CreditCard.prototype.email=null,CreditCard.creditCardWithNumber=function(number,cvc,expMonth,expYear,email,company){return Firehose.Object._objectOfClassWithID(Firehose.CreditCard,{number:number,cvc:cvc,expirationMonth:expMonth,expirationYear:expYear,email:email,company:company})},CreditCard.creditCardWithID=function(id,company){return Firehose.Object._objectOfClassWithID(Firehose.CreditCard,{id:id,company:company})},CreditCard.prototype.submitToStripe=function(callback,ccEmail){var errorsFound,_ref1,_ref2,_ref3,_this=this;return this.clearErrors(),errorsFound=[],(!(null!=(_ref1=this.number)?_ref1.trim():void 0)||number.length<14)&&errorsFound.push(stripeErrorCodes.invalidNumber),("function"==typeof this.cvc?this.cvc(trim()):void 0)||errorsFound.push(stripeErrorCodes.invalidCVC),(null!=(_ref2=this.expirationMonth)?_ref2.trim():void 0)||errorsFound.push(stripeErrorCodes.invalidExpiryMonth),(null!=(_ref3=this.expirationYear)?_ref3.trim():void 0)||errorsFound.push(stripeErrorCodes.invalidExpiryYear),Stripe.card.createToken({number:this.number,cvc:this.cvc,exp_month:this.expirationMonth,exp_year:this.expirationYear},function(status,response){var hasErrors;return hasErrors=!1,response.error?(errorsFound.push(response.error.code),hasErrors=!0):(_this._setIfNotNull("expirationMonth",response.card.exp_month),_this._setIfNotNull("expirationYear",response.card.exp_year),_this._setIfNotNull("lastFour",response.card.last4),_this._setIfNotNull("stripeToken",response.id),_this._setIfNotNull("email",null!=ccEmail?ccEmail:Firehose.Agent.loggedInAgent.email),hasErrors=errorsFound.length>0),hasErrors&&($.inArray(_stripeErrorCodes.invalidNumber,errorsFound)>-1&&_this.errors.push("Invalid credit card number"),$.inArray(_stripeErrorCodes.invalidCVC,errorsFound)>-1&&_this.errors.push("Invalid CVV"),$.inArray(_stripeErrorCodes.invalidExpiryMonth,errorsFound)>-1&&_this.errors.push("Invalid Expiration Month"),$.inArray(_stripeErrorCodes.invalidExpiryYear,errorsFound)>-1&&_this.errors.push("Invalid Expiration Year")),callback(hasErrors)})},CreditCard.prototype.save=function(){var params,_this=this;return Firehose.client.billingAccessToken=this.company.token,params={server:"billing",route:"entities/"+this.company.id+"/credit_card",body:this._toJSON()},Firehose.client.put(this,params).done(function(){return _this.company.set("creditCard",_this)})},CreditCard.prototype.fetch=function(){var params,_this=this;return Firehose.client.billingAccessToken=this.company.token,params={server:"billing",route:"entities/"+this.company.id+"/credit_card"},Firehose.client.get(this,params).done(function(data){return _this._populateWithJSON(data)})},CreditCard.prototype.destroy=function(){var params,_this=this;return Firehose.client.billingAccessToken=this.company.token,params={server:"billing",route:"entities/"+this.company.id+"/credit_card"},Firehose.client["delete"](this,params).done(function(){return _this.company.set("creditCard",null)})},CreditCard.prototype._populateWithJSON=function(json){return this._setIfNotNull("expirationMonth",json.expiration_month),this._setIfNotNull("expirationYear",json.expiration_year),this._setIfNotNull("lastFour",json.last_four),this._setIfNotNull("email",json.email),CreditCard.__super__._populateWithJSON.call(this,json)},CreditCard.prototype._toJSON=function(){return{credit_card:{expiration_month:this.expirationMonth,expiration_year:this.expirationYear,last_four:this.lastFour,stripe_token:this.stripeToken,email:this.email}}},CreditCard}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.Customer=function(_super){function Customer(){return _ref=Customer.__super__.constructor.apply(this,arguments)}return __extends(Customer,_super),Customer._firehoseType="Customer",Customer.prototype.company=null,Customer.prototype.name=null,Customer.prototype.location=null,Customer.prototype.timeZone=null,Customer.prototype.newestInteractionId=null,Customer.prototype.newestInteractionExcerpt=null,Customer.prototype.newestInteractionReceivedAt=null,Customer.prototype.agentWithDibs=null,Customer.prototype.customerAccounts=null,Customer.prototype.customerFlaggedAgents=null,Customer.prototype._interactions=null,Customer.prototype._setup=function(){return this.customerAccounts=new Firehose.UniqueArray,this.customerFlaggedAgents=new Firehose.UniqueArray,this.customerFlaggedAgents.sortOn("firstName")},Customer.customerWithID=function(id,company){return Firehose.Object._objectOfClassWithID(Firehose.Customer,{id:id,company:company})},Customer.customerWithJSON=function(json,company){var customer;return customer=this.customerWithID(json.id,company),customer._populateWithJSON(json),customer},Customer.prototype.fetch=function(){var params,_this=this;return params={route:"customers/"+this.id},Firehose.client.get(this,params).done(function(data){return _this._populateWithJSON(data)})},Customer.prototype.resolveAllInteractions=function(){var params;return params={route:"customers/"+this.id+"/resolve_all_interactions"},Firehose.client.put(this,params)},Customer.prototype.destroy=function(){var params,_this=this;return params={route:"customers/"+this.id},Firehose.client["delete"](this,params).done(function(){var _ref1;return null!=(_ref1=_this.company._customers)?_ref1.dropObject(_this):void 0})},Customer.prototype.interactions=function(){var _this=this;
return null==this._interactions&&(this._setIfNotNull("_interactions",new Firehose.RemoteArray("customers/"+this.id+"/interactions",null,function(json){return Firehose.Interaction._interactionWithJSON(json,_this)})),this._interactions.sortOn("receivedAt")),this._interactions},Customer.prototype._populateWithJSON=function(json){var _this=this;return this._setIfNotNull("name",json.name),this._setIfNotNull("location",json.location),this._setIfNotNull("timeZone",json.time_zone),this._setIfNotNull("newestInteractionId",json.newest_interaction_id),this._setIfNotNull("newestInteractionExcerpt",json.newest_interaction_excerpt),this._setIfNotNull("newestInteractionReceivedAt",this._date(json.newest_interaction_received_at)),this._populateAssociatedObjects(this,"customerAccounts",json.customer_accounts,function(json){return Firehose.CustomerAccount._customerAccountWithID(json.id,_this)}),this._populateAssociatedObjects(this,"customerFlaggedAgents",json.interaction_flagged_agents,function(json){return Firehose.Agent.agentWithID(json.id)}),this._populateAssociatedObjectWithJSON(this,"agentWithDibs",json.agent_with_dibs,function(json){return Firehose.Agent.agentWithID(json.id)}),Customer.__super__._populateWithJSON.call(this,json)},Customer}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.CustomerAccount=function(_super){function CustomerAccount(){return _ref=CustomerAccount.__super__.constructor.apply(this,arguments)}return __extends(CustomerAccount,_super),CustomerAccount._firehoseType="CustomerAccount",CustomerAccount.prototype.customer=null,CustomerAccount.prototype.username=null,CustomerAccount.prototype.followingUs=null,CustomerAccount.prototype.imageURL=null,CustomerAccount.prototype.description=null,CustomerAccount.prototype.followersCount=null,CustomerAccount.prototype.channel=null,CustomerAccount._customerAccountWithID=function(id,customer){return Firehose.Object._objectOfClassWithID(Firehose.CustomerAccount,{id:id,customer:customer})},CustomerAccount.prototype.avatarURL=function(){var e,hashedEmail;return this.imageURL?this.imageURL:(this.username.match(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i)&&(e=this.username.trim().toLowerCase(),hashedEmail=md5(e)),hashedEmail||(hashedEmail=md5(this.username)),"https://www.gravatar.com/avatar/"+hashedEmail+"?d=identicon")},CustomerAccount.prototype._populateWithJSON=function(json){return this._setIfNotNull("username",json.username),this._setIfNotNull("followingUs",json.following_us),this._setIfNotNull("imageURL",json.image_url),this._setIfNotNull("description",json.description),this._setIfNotNull("followersCount",json.followers_count),this._setIfNotNull("channel",json.channel),CustomerAccount.__super__._populateWithJSON.call(this,json)},CustomerAccount}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.EmailAccount=function(_super){function EmailAccount(){return _ref=EmailAccount.__super__.constructor.apply(this,arguments)}return __extends(EmailAccount,_super),EmailAccount._firehoseType="EmailAccount",EmailAccount.prototype.company=null,EmailAccount.prototype.emailAddress=null,EmailAccount.prototype.isForwarding=!1,EmailAccount.prototype.title=null,EmailAccount.prototype.kind="IMAP",EmailAccount.prototype.server=null,EmailAccount.prototype.port=null,EmailAccount.prototype.username=null,EmailAccount.prototype.password=null,EmailAccount.prototype.SSL=!0,EmailAccount.prototype.deleteFromServer=!1,EmailAccount.emailAccountWithSettings=function(company,settings){var emailAccount;return emailAccount={},emailAccount.company=company,null!=settings&&(null!=settings.emailAddress&&(emailAccount.emailAddress=settings.emailAddress),null!=settings.title&&(emailAccount.title=settings.title),null!=settings.kind&&(emailAccount.kind=settings.kind),null!=settings.server&&(emailAccount.server=settings.server),null!=settings.port&&(emailAccount.port=settings.port),null!=settings.username&&(emailAccount.username=settings.username),null!=settings.password&&(emailAccount.password=settings.password),null!=settings.SSL&&(emailAccount.SSL=settings.SSL),null!=settings.deleteFromServer&&(emailAccount.deleteFromServer=settings.deleteFromServer)),Firehose.Object._objectOfClassWithID(Firehose.EmailAccount,emailAccount)},EmailAccount._emailAccountWithID=function(id,company){return Firehose.Object._objectOfClassWithID(Firehose.EmailAccount,{id:id,company:company})},EmailAccount.prototype.save=function(){var params,_this=this;return null!=this.id?(params={route:"email_accounts/"+this.id,body:this._toJSON()},Firehose.client.put(this,params)):(params={route:"companies/"+this.company.id+"/email_accounts",body:this._toJSON()},Firehose.client.post(this,params).done(function(data){return _this._populateWithJSON(data),_this.company.emailAccounts().insertObject(_this)}))},EmailAccount.prototype.destroy=function(){var params,_this=this;return params={route:"email_accounts/"+this.id},Firehose.client["delete"](this,params).done(function(){return _this.company.emailAccounts().dropObject(_this)})},EmailAccount.prototype._popularServices=[{domain:"gmail.com",kind:"IMAP",SSL:!0,port:993,server:"imap.googlemail.com"},{domain:"hotmail.com",kind:"POP",SSL:!0,port:995,server:"pop3.live.com"},{domain:"live.com",kind:"POP",SSL:!0,port:995,server:"pop3.live.com"},{domain:"outlook.com",kind:"IMAP",SSL:!0,port:993,server:"imap-mail.outlook.com"},{domain:"aol.com",kind:"IMAP",SSL:!0,port:993,server:"imap.aol.com"},{domain:"aim.com",kind:"IMAP",SSL:!0,port:993,server:"imap.aim.com"},{domain:"me.com",kind:"IMAP",SSL:!0,port:993,server:"imap.mail.me.com"},{domain:"mac.com",kind:"IMAP",SSL:!0,port:993,server:"imap.mail.me.com"},{domain:"icloud.com",kind:"IMAP",SSL:!0,port:993,server:"imap.mail.me.com"},{domain:"yahoo.com",kind:"IMAP",SSL:!0,port:993,server:"imap.mail.yahoo.com"}],EmailAccount.prototype.guessFieldsFromEmail=function(){var domain,service,_i,_len,_ref1,_ref2;if(null!=(_ref1=this.username)?_ref1.trim():void 0)for(_ref2=this._popularServices,_i=0,_len=_ref2.length;_len>_i;_i++)if(service=_ref2[_i],domain="@"+service.domain,-1!==this.username.indexOf(domain))return this._setIfNotNull("kind",service.kind),this._setIfNotNull("SSL",service.SSL),this._setIfNotNull("port",service.port),this._setIfNotNull("server",service.server),this._setIfNotNull("isForwarding",!1),this.errors=[],!0;return this.errors=["More information needed"],!1},EmailAccount.prototype._populateWithJSON=function(json){return this._setIfNotNull("emailAddress",json.email),null==this.title&&this._setIfNotNull("title",json.title),this._setIfNotNull("isForwarding",json.forwarding),this._setIfNotNull("server",json.incoming_server),this._setIfNotNull("SSL",json.incoming_ssl),null==this.port&&this._setIfNotNull("port",json.incoming_port),this._setIfNotNull("username",json.incoming_username),this._setIfNotNull("kind",json.kind),this._setIfNotNull("deleteFromServer",json.delete_from_server),EmailAccount.__super__._populateWithJSON.call(this,json)},EmailAccount.prototype._toJSON=function(){return{email_account:{email:this.emailAddress?this.emailAddress:void 0,title:this.title?this.title:void 0,forwarding:null!=this.isForwarding?this.isForwarding:void 0,incoming_server:this.server?this.server:void 0,incoming_ssl:null!=this.SSL?this.SSL:void 0,incoming_port:this.port?this.port:void 0,incoming_username:this.username?this.username:void 0,incoming_password:null!=this.password?this.password:void 0,kind:this.kind?this.kind:void 0,delete_from_server:null!=this.deleteFromServer?this.deleteFromServer:void 0}}},EmailAccount}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.EmailInteraction=function(_super){function EmailInteraction(){return _ref=EmailInteraction.__super__.constructor.apply(this,arguments)}return __extends(EmailInteraction,_super),EmailInteraction._firehoseType="EmailInteraction",EmailInteraction.prototype.emailAccount=null,EmailInteraction.prototype.emailSubject=null,EmailInteraction.prototype.replyTo=null,EmailInteraction.prototype.toEmail=null,EmailInteraction.prototype.fromEmail=null,EmailInteraction.prototype.attachments=null,EmailInteraction.prototype._setup=function(){return this.attachments=new Firehose.UniqueArray},EmailInteraction._emailInteractionWithID=function(id){return Firehose.Object._objectOfClassWithID(Firehose.EmailInteraction,{id:id})},EmailInteraction.prototype._populateWithJSON=function(json){var emailJSON,_this=this;return null!=json.email_interaction&&(emailJSON=json.email_interaction,this._setIfNotNull("emailSubject",emailJSON.subject),this._setIfNotNull("replyTo",emailJSON.reply_to),this._setIfNotNull("toEmail",emailJSON.to_email),this._setIfNotNull("fromEmail",emailJSON.from_email),this._populateAssociatedObjects(this,"attachments",emailJSON.attachments,function(json){return Firehose.Attachment._attachmentWithID(json.id,_this)}),this._populateAssociatedObjectWithJSON(this,"emailAccount",emailJSON.email_account,function(json){return Firehose.EmailAccount._emailAccountWithID(json.id)})),EmailInteraction.__super__._populateWithJSON.call(this,json)},EmailInteraction}(Firehose.Interaction);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.FacebookAccount=function(_super){function FacebookAccount(){return _ref=FacebookAccount.__super__.constructor.apply(this,arguments)}return __extends(FacebookAccount,_super),FacebookAccount._firehoseType="FacebookAccount",FacebookAccount.prototype.company=null,FacebookAccount.prototype.username=null,FacebookAccount.prototype.facebookUserId=null,FacebookAccount.prototype.imageURL=null,FacebookAccount.prototype.name=null,FacebookAccount.prototype.facebookPages=null,FacebookAccount.prototype._setup=function(){return this.facebookPages=new Firehose.UniqueArray},FacebookAccount._facebookAccountWithID=function(id,company){return Firehose.Object._objectOfClassWithID(Firehose.FacebookAccount,{id:id,company:company})},FacebookAccount.OAuthURLForCompanyWithCallback=function(company,callback){return""+Firehose.baseURLFor("API")+"/companies/"+company.id+"/oauth_facebook?url_token="+Firehose.client.URLToken+"&callback_url="+encodeURIComponent(callback)},FacebookAccount.prototype.destroy=function(){var params,_this=this;return params={route:"facebook_accounts/"+this.id},Firehose.client["delete"](this,params).done(function(){return _this.company.facebookAccounts().dropObject(_this)})},FacebookAccount.prototype._populateWithJSON=function(json){var _this=this;return this._setIfNotNull("username",json.username),this._setIfNotNull("facebookUserId",json.facebook_user_id),this._setIfNotNull("imageURL",json.image_url),this._setIfNotNull("name",json.name),this._populateAssociatedObjects(this,"facebookPages",json.facebook_pages,function(json){return Firehose.FacebookPage._facebookPageWithID(json.id,_this)}),FacebookAccount.__super__._populateWithJSON.call(this,json)},FacebookAccount}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.FacebookInteraction=function(_super){function FacebookInteraction(){return _ref=FacebookInteraction.__super__.constructor.apply(this,arguments)}return __extends(FacebookInteraction,_super),FacebookInteraction._firehoseType="FacebookInteraction",FacebookInteraction.prototype.facebookAccount=null,FacebookInteraction.prototype.fromUserId=null,FacebookInteraction.prototype.fromName=null,FacebookInteraction.prototype.toUserId=null,FacebookInteraction.prototype.toName=null,FacebookInteraction.prototype.postId=null,FacebookInteraction.prototype.commentId=null,FacebookInteraction.prototype.postType=null,FacebookInteraction.prototype.postExcerpt=null,FacebookInteraction.prototype.likeCount=0,FacebookInteraction._facebookInteractionWithID=function(id){return Firehose.Object._objectOfClassWithID(Firehose.FacebookInteraction,{id:id})},FacebookInteraction.prototype._populateWithJSON=function(json){var facebookJSON;return null!=json.facebook_interaction&&(facebookJSON=json.facebook_interaction,this._setIfNotNull("fromUserId",facebookJSON.from_user_id),this._setIfNotNull("fromName",facebookJSON.from_name),this._setIfNotNull("toUserId",facebookJSON.to_user_id),this._setIfNotNull("toName",facebookJSON.to_name),this._setIfNotNull("postId",facebookJSON.post_id),this._setIfNotNull("commentId",facebookJSON.comment_id),this._setIfNotNull("postType",facebookJSON.post_type),this._setIfNotNull("postExcerpt",facebookJSON.post_excerpt),this._setIfNotNull("likeCount",facebookJSON.like_count),this._populateAssociatedObjectWithJSON(this,"facebookAccount",facebookJSON.facebook_account,function(json){return Firehose.FacebookAccount._facebookAccountWithID(json.id)})),FacebookInteraction.__super__._populateWithJSON.call(this,json)},FacebookInteraction}(Firehose.Interaction);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.FacebookPage=function(_super){function FacebookPage(){return _ref=FacebookPage.__super__.constructor.apply(this,arguments)}return __extends(FacebookPage,_super),FacebookPage._firehoseType="FacebookPage",FacebookPage.prototype.facebookAccount=null,FacebookPage.prototype.name=null,FacebookPage.prototype.category=null,FacebookPage.prototype.pageId=null,FacebookPage.prototype.active=!1,FacebookPage._facebookPageWithID=function(id,facebookAccount){return Firehose.Object._objectOfClassWithID(Firehose.FacebookPage,{id:id,facebookAccount:facebookAccount})},FacebookPage.prototype.save=function(){var params;return params={route:"facebook_pages/"+this.id,body:this._toJSON()},Firehose.client.put(this,params)},FacebookPage.prototype._populateWithJSON=function(json){return this._setIfNotNull("name",json.name),this._setIfNotNull("category",json.category),this._setIfNotNull("pageId",json.page_id),this._setIfNotNull("active",json.active),FacebookPage.__super__._populateWithJSON.call(this,json)},FacebookPage.prototype._toJSON=function(){return{facebook_page:{active:this.active}}},FacebookPage}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.Note=function(_super){function Note(){return _ref=Note.__super__.constructor.apply(this,arguments)}return __extends(Note,_super),Note._firehoseType="Note",Note.prototype.interaction=null,Note.prototype.body=null,Note.prototype.agent=null,Note.noteWithBody=function(body,interaction){return Firehose.Object._objectOfClassWithID(Firehose.Note,{body:body,interaction:interaction})},Note._noteWithID=function(id,interaction){return Firehose.Object._objectOfClassWithID(Firehose.Note,{id:id,interaction:interaction})},Note.prototype.save=function(){var params,_this=this;return null!=this.id?(params={route:"notes/"+this.id,body:this._toJSON()},Firehose.client.put(this,params)):(params={route:"interactions/"+this.interaction.id+"/notes",body:this._toJSON()},Firehose.client.post(this,params).done(function(data){return _this._populateWithJSON(data),_this.interaction.notes.insertObject(_this)}))},Note.prototype.destroy=function(){var params,_this=this;return params={route:"notes/"+this.id},Firehose.client["delete"](this,params).done(function(){return _this.interaction.notes.dropObject(_this)})},Note.prototype._populateWithJSON=function(json){return this._setIfNotNull("body",json.body),this._populateAssociatedObjectWithJSON(this,"agent",json.agent,function(json){return Firehose.Agent.agentWithID(json.id)}),Note.__super__._populateWithJSON.call(this,json)},Note.prototype._toJSON=function(){return{note:{body:this.body}}},Note}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.Notification=function(_super){function Notification(){return _ref=Notification.__super__.constructor.apply(this,arguments)}return __extends(Notification,_super),Notification._firehoseType="Notification",Notification.prototype.company=null,Notification.prototype.title=null,Notification.prototype.text=null,Notification.prototype.level=0,Notification._notificationWithID=function(id,company){return Firehose.Object._objectOfClassWithID(Firehose.Notification,{id:id,company:company})},Notification.prototype._populateWithJSON=function(json){return this._setIfNotNull("title",json.title),this._setIfNotNull("text",json.text),this._setIfNotNull("level",json.level),Notification.__super__._populateWithJSON.call(this,json)},Notification}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.OutgoingAttachment=function(_super){function OutgoingAttachment(){return _ref=OutgoingAttachment.__super__.constructor.apply(this,arguments)}return __extends(OutgoingAttachment,_super),OutgoingAttachment._firehoseType="OutgoingAttachment",OutgoingAttachment.prototype.company=null,OutgoingAttachment.prototype.token=null,OutgoingAttachment.prototype.downloadURL=null,OutgoingAttachment.prototype.uploadURL=null,OutgoingAttachment.prototype.uploaded=!1,OutgoingAttachment.prototype.file=null,OutgoingAttachment.outgoingAttachmentWithFile=function(file,company){return new Firehose.OutgoingAttachment({file:file,company:company})},OutgoingAttachment.openFilePicker=function(completion){var fileEl;return fileEl=$('<input type="file"/>'),fileEl.bind("change",function(e){var file;return file=e.target.files[0],file.size>1073741824?void alert("Files must be smaller than 1GB."):file.size>314572800?void alert("File sizes greater than 300MB have a higher chance of failure when uploaded from a browser. If you experience problems, perhaps try it from the Mac app."):completion(file)}),fileEl.trigger("click")},OutgoingAttachment.prototype.upload=function(options){var params,_this=this;return null==options&&(options={}),params={route:"companies/"+this.company.id+"/outgoing_attachments",body:this._toJSON()},Firehose.client.post(this,params).done(function(data){var xhr,_ref1;return _this._populateWithJSON(data),xhr=new XMLHttpRequest,"withCredentials"in xhr?xhr.open("PUT",data.upload_url,!0):"undefined"!=typeof XDomainRequest&&(xhr=new XDomainRequest,xhr.open("PUT",data.upload_url)),null!=options.progress&&null!=(_ref1=xhr.upload)&&_ref1.addEventListener("progress",function(event){var percentComplete;return event.lengthComputable?(percentComplete=parseInt(event.loaded/event.total*100,10),options.progress(percentComplete>=95?95:percentComplete)):void 0}),xhr.onload=function(){return 200===xhr.status?(_this.uploaded=!0,params={route:"outgoing_attachments/"+data.id,body:_this._toJSON()},Firehose.client.put(_this,params).done(function(){return"function"==typeof options.success?options.success(data.download_url):void 0}).fail(function(jqXHR,textStatus,errorThrown){return"function"==typeof options.error?options.error(errorThrown):void 0})):"function"==typeof options.error?options.error("Your attachment failed to upload successfully, please try again. Please contact support@getfirehose.com if the problem persists and we'll get it fixed for you."):void 0},xhr.onerror=function(){return"function"==typeof options.error?options.error("Your attachment failed to upload successfully, please try again. Please contact support@getfirehose.com if the problem persists and we'll get it fixed for you."):void 0},xhr.setRequestHeader("Content-Type",_this.file.type),xhr.setRequestHeader("x-amz-acl","authenticated-read"),xhr.send(_this.file)}).fail(function(jqXHR,textStatus,errorThrown){return"function"==typeof options.error?options.error(errorThrown):void 0})},OutgoingAttachment.prototype._populateWithJSON=function(json){return this._setIfNotNull("downloadURL",json.download_url),this._setIfNotNull("uploadURL",json.upload_url),OutgoingAttachment.__super__._populateWithJSON.call(this,json)},OutgoingAttachment.prototype._toJSON=function(){return{outgoing_attachment:{filename:this.file.name,mimetype:this.file.type||"application/zip",uploaded:this.uploaded}}},OutgoingAttachment}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.Tag=function(_super){function Tag(){return _ref=Tag.__super__.constructor.apply(this,arguments)}return __extends(Tag,_super),Tag._firehoseType="Tag",Tag.prototype.company=null,Tag.prototype.label=null,Tag.tagWithLabel=function(label,company){return Firehose.Object._objectOfClassWithID(Firehose.Tag,{label:label,company:company})},Tag._tagWithID=function(id,company){return Firehose.Object._objectOfClassWithID(Firehose.Tag,{id:id,company:company})},Tag.prototype.save=function(){var params,_this=this;return null!=this.id?(params={route:"tags/"+this.id,body:this._toJSON()},Firehose.client.put(this,params)):(params={route:"companies/"+this.company.id+"/tags",body:this._toJSON()},Firehose.client.post(this,params).done(function(data){return _this._populateWithJSON(data),_this.company.tags.insertObject(_this)}))},Tag.prototype.destroy=function(){var params,_this=this;return params={route:"tags/"+this.id},Firehose.client["delete"](this,params).done(function(){return _this.company.tags.dropObject(_this)})},Tag.prototype._populateWithJSON=function(json){return this._setIfNotNull("label",json.label),Tag.__super__._populateWithJSON.call(this,json)},Tag.prototype._toJSON=function(){return{tag:{label:this.label}}},Tag.prototype._toArchivableJSON=function(){return $.extend(Tag.__super__._toArchivableJSON.call(this),{label:this.label})},Tag}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.TwitterAccount=function(_super){function TwitterAccount(){return _ref=TwitterAccount.__super__.constructor.apply(this,arguments)}return __extends(TwitterAccount,_super),TwitterAccount._firehoseType="TwitterAccount",TwitterAccount.prototype.company=null,TwitterAccount.prototype.screenName=null,TwitterAccount.prototype.twitterUserId=null,TwitterAccount.prototype.imageURL=null,TwitterAccount._twitterAccountWithID=function(id,company){return Firehose.Object._objectOfClassWithID(Firehose.TwitterAccount,{id:id,company:company})},TwitterAccount.OAuthURLForCompanyWithCallback=function(company,callback){return""+Firehose.baseURLFor("API")+"/companies/"+company.id+"/oauth_twitter?url_token="+Firehose.client.URLToken+"&callback_url="+encodeURIComponent(callback)},TwitterAccount.prototype.destroy=function(){var params,_this=this;return params={route:"twitter_accounts/"+this.id},Firehose.client["delete"](this,params).done(function(){return _this.company.twitterAccounts().dropObject(_this)})},TwitterAccount.prototype._populateWithJSON=function(json){return this._setIfNotNull("screenName",json.screen_name),this._setIfNotNull("twitterUserId",json.twitter_user_id),this._setIfNotNull("imageURL",json.image_url),TwitterAccount.__super__._populateWithJSON.call(this,json)},TwitterAccount}(Firehose.Object);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.TwitterInteraction=function(_super){function TwitterInteraction(){return _ref=TwitterInteraction.__super__.constructor.apply(this,arguments)}return __extends(TwitterInteraction,_super),TwitterInteraction._firehoseType="TwitterInteraction",TwitterInteraction.prototype.twitterAccount=null,TwitterInteraction.prototype.favorited=!1,TwitterInteraction.prototype.tweetId=null,TwitterInteraction.prototype.inReplyToScreenName=null,TwitterInteraction.prototype.inReplyToStatusId=null,TwitterInteraction.prototype.retweetCount=0,TwitterInteraction.prototype.tweetSource=null,TwitterInteraction.prototype.toUserId=null,TwitterInteraction.prototype.toScreenName=null,TwitterInteraction.prototype.fromUserId=null,TwitterInteraction._twitterInteractionWithID=function(id){return Firehose.Object._objectOfClassWithID(Firehose.TwitterInteraction,{id:id})},TwitterInteraction.prototype._populateWithJSON=function(json){var twitterJSON;return null!=json.twitter_interaction&&(twitterJSON=json.twitter_interaction,this._setIfNotNull("favorited",twitterJSON.favorited),this._setIfNotNull("tweetId",twitterJSON.tweet_id),this._setIfNotNull("inReplyToScreenName",twitterJSON.in_reply_to_screen_name),this._setIfNotNull("inReplyToStatusId",twitterJSON.in_reply_to_status_id),this._setIfNotNull("retweetCount",twitterJSON.retweet_count),this._setIfNotNull("tweetSource",twitterJSON.tweet_source),this._setIfNotNull("toUserId",twitterJSON.to_user_id),this._setIfNotNull("toScreenName",twitterJSON.twitter_account.screen_name),this._setIfNotNull("fromUserId",twitterJSON.from_user_id),this._populateAssociatedObjectWithJSON(this,"twitterAccount",twitterJSON.twitter_account,function(json){return Firehose.TwitterAccount._twitterAccountWithID(json.id)})),TwitterInteraction.__super__._populateWithJSON.call(this,json)},TwitterInteraction}(Firehose.Interaction);var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Firehose.Article=function(_super){function Article(){return _ref=Article.__super__.constructor.apply(this,arguments)}return __extends(Article,_super),Article._firehoseType="Article",Article.prototype.company=null,Article.prototype.slug=null,Article.prototype.title=null,Article.prototype.body=null,Article.articleWithTitleBodyAndCompany=function(title,body,company){return Firehose.Object._objectOfClassWithID(Firehose.Article,{title:title,body:body,company:company})},Article.articleWithID=function(id,company){return Firehose.Object._objectOfClassWithID(Firehose.Article,{id:id,company:company})},Article.prototype.fetch=function(){var params,_this=this;return params={auth:!1,route:"articles/"+this.id},Firehose.client.get(this,params).done(function(data){return _this._populateWithJSON(data)})},Article.prototype.save=function(){var params,_this=this;return null!=this.id?(params={route:"articles/"+this.id,body:this._toJSON()},Firehose.client.put(this,params)):(params={route:"companies/"+this.company.id+"/articles",body:this._toJSON()},Firehose.client.post(this,params).done(function(data){return _this._populateWithJSON(data),_this.company.articles().insertObject(_this)}))},Article.prototype.destroy=function(){var params,_this=this;return params={route:"articles/"+this.id},Firehose.client["delete"](this,params).done(function(){return _this.company.articles().dropObject(_this)})},Article.prototype._populateWithJSON=function(json){return this._setIfNotNull("title",json.title),this._setIfNotNull("body",json.body),this._setIfNotNull("slug",json.slug),Article.__super__._populateWithJSON.call(this,json)},Article.prototype._toJSON=function(){return{article:{title:this.title,body:this.body}}},Article}(Firehose.Object);